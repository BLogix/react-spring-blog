<!DOCTYPE html>
    <head>
        <meta charset="UTF-8"/>

        <!-- react 16.8.6 -->
        <script src="js/libs/react.development.js"></script>
        <script src="js/libs/react-dom.development.js"></script>

        <script src='js/libs/react-router-dom.min.js'></script>

        <!-- 
            Once development work is done then use the minified production libs
        -->
        <!--script src="js/libs/react.production.min.js"></script>
        <script src="js/libs/react-dom.production.min.js"></script-->

        <!-- Babel 6.21.1-->
        <!-- 
            https://babeljs.io/en/setup 
            - click on 'In the browser' for this application 
            - it explains why we need to use the <script type="text/babel"> tag
        -->
        <script src='js/libs/babel.min.js'></script>

        <!-- Any other libs can be imported using the script tag -->

        <!-- Stylesheets -->
        <link rel='stylesheet' href='style/index.css' type='text/css'>
    </head>
    <body>
        <!-- ----------------------------------------------------------main container -->
        <div id="root"></div>

        <!-- -------------------------------------------------------react context api -->
        <!-- 
            * We want to use the Context API for passing data between many component 
            * without the dependancy of having to pass them through the component tree
            * 
            * Reference Links
            * -> https://reactjs.org/docs/context.html
            * -> https://medium.com/@niwaa/simple-and-reusable-react-context-api-example-hoc-e1e50c0390ec
            * 
            * Main Concepts
            * -> Provider -> allows for consuming components to subscribe to context changes
            * -> Consumer -> a react component that subscribes to a consumer     
        -->
        <script type="text/babel">
             //Context
            const AppContext = React.createContext({
                foodContext: {
                    foodTypes: [],
                    meats: [],
                    sides: [],
                    orderSizes: [],
                    orderNumber: '',
                    createOrder: () => {}
                }
            });

            //Consumer
            const withContext = (Component)=>{
                return function ContextComponent(props){
                    return(
                        <AppContext.Consumer>
                            {(contexts) => <Component {...props} {...contexts}/>}
                        </AppContext.Consumer>
                    )
                }
            };

            //Provider
            class ContextProvider extends React.Component{
                constructor(){
                    super();

                    this.state = {
                        foodTypes: ['taco', 'burger', 'panini', 'sausage'],
                        meats: ['chicken', 'beef', 'charizo', 'turkey'],
                        sides: ['french fries', 'tots', 'chips', 'salad'],
                        orderSizes: ['small', 'medium', 'large'],
                        orderNumber: this.generateOrderNumber(),
                        createOrder: this.createOrder.bind(this)
                    };
                }

                generateOrderNumber = (explict) => {
                    const num = explict === undefined ? 10 : explict;

                    return Math.floor((Math.random() * num) + 1);
                };

                createOrder = () => {
                    const {foodTypes, meats, sides, orderSizes} = this.state;

                    const foodIndex = this.generateOrderNumber(foodTypes.length -1);
                    const foodType = foodTypes[foodIndex];

                    const meatIndex = this.generateOrderNumber(meats.length -1);
                    const meatType = meats[meatIndex];

                    const sideIndex = this.generateOrderNumber(sides.length -1);
                    const sideType = sides[sideIndex];

                    const sizeIndex = this.generateOrderNumber(orderSizes.length -1);
                    const sizeType = orderSizes[sizeIndex];

                    return {type: foodType, meat: meatType, side: sideType, size: sizeType};
                };

                render(){
                    this.createOrder();

                    return(
                        <AppContext.Provider value={{foodContext: {...this.state}}}>
                            {this.props.children}
                        </AppContext.Provider>
                    )
                }
            }
        </script>

        <!-- survey -->
        <script type='text/babel'>
            class ViewerDef extends React.Component{
                constructor(){
                    super();
            
                    this.state = {
                        fullOrder: {}
                    };

                    this.handleChange = this.handleChange.bind(this);
                    this.handleSubmit = this.handleSubmit.bind(this);
                }

                retrieveSurveyOrder = () => {

                };
            
                handleChange(event){
            
                }
            
                handleSubmit(event){
                    
                }
            
                render(){
                    const {orderNumber} = this.props.foodContext;

                    this.retrieveSurveyOrder();
                    return(
                        <div className={'wrapper'}>
                            <h1>Thank You!</h1>
                            <h4>Please Rate Our Food</h4>
                            <p>order no: {orderNumber}</p>
                            <section className={'form-center'}>
                                <form onSubmit={this.handleSubmit}>
                                </form>
                            </section>
                        </div>
                    )
                }
            }
            
            const Viewer = withContext(ViewerDef);
        </script>

        <!-- router -->
        <script type='text/babel'>
            const {BrowserRouter, Route} = ReactRouterDOM;

            class App extends React.Component{
                render(){
                    return(
                        <BrowserRouter>
                            <Route path={'/'} component={Viewer}/>
                        </BrowserRouter>
                    )
                }
            }
        </script>

        <!-- index.js -->
        <script type='text/babel'>
            ReactDOM.render(
                <ContextProvider>
                    <App/>
                </ContextProvider>, 
                document.getElementById('root')
            )
        </script>
    </body>
</html>