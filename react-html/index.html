<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="UTF-8"/>
        <title>React Your Way</title>

        <!-- react 16.8.6 -->
        <script src="js/libs/react.development.js"></script>
        <script src="js/libs/react-dom.development.js"></script>

        <script src='js/libs/react-router-dom.min.js'></script>

        <!-- 
            Once development work is done then use the minified production libs
        -->
        <!--script src="js/libs/react.production.min.js"></script>
        <script src="js/libs/react-dom.production.min.js"></script-->

        <!-- Babel 6.21.1-->
        <!-- 
            https://babeljs.io/en/setup/#usage
            - it explains why we need to use the <script type="text/babel"> tag
        -->
        <script src='js/libs/babel.min.js'></script>

        <!-- Any other libs can be imported using the script tag -->

        <!-- Stylesheets -->
        <link rel='stylesheet' href='style/index.css' type='text/css'>
    </head>
    <body>
        <!-- ----------------------------------------------------------main container -->
        <div id="root"></div>

        <!-- -------------------------------------------------------react context api -->
        <!-- 
            * We want to use the Context API for passing data between many component 
            * without the dependancy of having to pass them through the component tree
            * 
            * Reference Links
            * -> https://reactjs.org/docs/context.html
            * -> https://medium.com/@niwaa/simple-and-reusable-react-context-api-example-hoc-e1e50c0390ec
            * 
            * Main Concepts
            * -> Provider -> allows for consuming components to subscribe to context changes
            * -> Consumer -> a react component that subscribes to a consumer     
        -->
        <script type="text/babel">
             //Context
            const AppContext = React.createContext({
                foodContext: {
                    foodTypes: [],
                    meats: [],
                    sides: [],
                    orderSizes: [],
                    orderNumber: '',
                    createOrder: () => {}
                }
            });

            //Consumer
            const withContext = (Component)=>{
                return function ContextComponent(props){
                    return(
                        <AppContext.Consumer>
                            {(contexts) => <Component {...props} {...contexts}/>}
                        </AppContext.Consumer>
                    )
                }
            };

            //Provider
            class ContextProvider extends React.Component{
                constructor(){
                    super();

                    this.state = {
                        foodTypes: ['taco', 'burger', 'panini', 'sausage'],
                        meats: ['chicken', 'beef', 'charizo', 'turkey'],
                        sides: ['french fries', 'tots', 'chips', 'a salad'],
                        orderSizes: ['small', 'medium', 'large'],
                        orderNumber: this.generateOrderNumber(),
                        createOrder: this.createOrder.bind(this)
                    };
                }

                generateOrderNumber = (explict) => {
                    const num = explict === undefined ? 10 : explict;

                    return Math.floor((Math.random() * num) + 1);
                };

                createOrder = () => {
                    const {foodTypes, meats, sides, orderSizes} = this.state;

                    const foodIndex = this.generateOrderNumber(foodTypes.length -1);
                    const foodType = foodTypes[foodIndex];

                    const meatIndex = this.generateOrderNumber(meats.length -1);
                    const meatType = meats[meatIndex];

                    const sideIndex = this.generateOrderNumber(sides.length -1);
                    const sideType = sides[sideIndex];

                    const sizeIndex = this.generateOrderNumber(orderSizes.length -1);
                    const sizeType = orderSizes[sizeIndex];

                    return {type: foodType, meat: meatType, side: sideType, size: sizeType};
                };

                render(){
                    this.createOrder();

                    return(
                        <AppContext.Provider value={{foodContext: {...this.state}}}>
                            {this.props.children}
                        </AppContext.Provider>
                    )
                }
            }
        </script>

        <!-- Star -->
        <script type="text/babel">
            function Star(props){
                return(
                    <div className={'star-wrapper'}>
                        {props.grayscale
                            ?
                                <img className="pointer filter-grayscale" src={'./resource/yellow-star.png'} alt={'star'}/>
                            :
                                <img className="pointer" src={'./resource/yellow-star.png'} alt={'star'}/>
                        }
                    </div>
                )
            }
        </script>

        <!-- survey -->
        <script type='text/babel'>
            class SurveyDef extends React.Component{
                constructor(){
                    super();
            
                    this.state = {
                        stars: [1,2,3,4,5],
                        rating: [],
                        clickedStar: 0
                    };

                    this.handleChange = this.handleChange.bind(this);
                    this.handleSubmit = this.handleSubmit.bind(this);
                }
            
                handleChange=(event)=>this.setState({clickedStar: event.currentTarget.id-1});
            
                handleSubmit(event){
                    event.preventDefault();
                    const {clickedStar} = this.state;

                    if (clickedStar + 1 > 1 && clickedStar + 1 < 5){
                        alert(`Woot! ${clickedStar+1} stars!`);
                    } else if(clickedStar + 1 === 5){
                        alert(`Oh snap!!! We got ${clickedStar+1} stars!`);
                    } else {
                        alert(`Ohhh... ${clickedStar+1} star`);
                    }
                }

                decideGrayscale=(index)=>(index <= this.state.clickedStar);

                componentDidMount(){
                    const {createOrder} = this.props.foodContext;

                    const order = createOrder();

                    const sentence = `${order.size} ${order.meat} ${order.type} with ${order.side}`;

                    this.setState({rating:
                            <section>
                                <p>Thank you for your order of <br/> 1 {sentence} <br/><br/> How many stars do you give us?</p>
                            </section>
                    })
                }
            
                render(){
                    const {orderNumber} = this.props.foodContext;
                    const {stars, rating} = this.state;

                    return(
                        <div className={'wrapper'}>
                            <h1>Thank You!</h1>
                            <h4>Please Rate Our Food</h4>
                            <p>order no: {orderNumber}</p>

                            <section className={'form-center'}>
                                <form onSubmit={this.handleSubmit}>
                                    {rating}

                                    <section className={'star-box'}>
                                        {stars.map((star, index) =>
                                            <section key={index} id={`${star}`} onClick={this.handleChange}>
                                                <Star grayscale={!this.decideGrayscale(index)}/>
                                            </section>
                                        )}
                                    </section>

                                    <section className={'submit-wrapper'}>
                                        <input className={'submit-btn'} type='submit' value={'Let Us Know'}/>
                                    </section>
                                </form>
                            </section>
                        </div>
                    )
                }
            }
            
            const Survey = withContext(SurveyDef);
        </script>

        <!-- router -->
        <script type='text/babel'>
            const {BrowserRouter, Route} = ReactRouterDOM;

            class App extends React.Component{
                render(){
                    return(
                        <BrowserRouter>
                            <Route path={'/'} component={Survey}/>
                        </BrowserRouter>
                    )
                }
            }
        </script>

        <!-- index.js -->
        <script type='text/babel'>
            ReactDOM.render(
                <ContextProvider>
                    <App/>
                </ContextProvider>, 
                document.getElementById('root')
            )
        </script>
    </body>
</html>